For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return g.useEffect(()=>{e&&(document.getElementById(e)||console.error(n))},[n,e]),null},H1e="DialogDescriptionWarning",K1e=({contentRef:e,descriptionId:t})=>{const r=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${C5(H1e).contentName}}.`;return g.useEffect(()=>{var o;const i=(o=e.current)==null?void 0:o.getAttribute("aria-describedby");t&&i&&(document.getElementById(t)||console.warn(r))},[r,e,t]),null},q1e=m5,G1e=y5,I5=w5,O5=_5,k5=x5,R5=S5,N5=T5;const _u=q1e,Y1e=G1e,Ba=N5,D5=g.forwardRef(({className:e,...t},n)=>(g.useEffect(()=>(document.documentElement.classList.add("modal-open"),document.body.classList.add("modal-open"),()=>{document.documentElement.classList.remove("modal-open"),document.body.classList.remove("modal-open")}),[]),v.jsx(I5,{ref:n,className:ye("fixed inset-0 z-40 bg-slate-950/60 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out",e),...t})));D5.displayName=I5.displayName;const Wa=g.forwardRef(({className:e,children:t,...n},r)=>{const i=typeof document<"u"?document.body:void 0;return v.jsxs(Y1e,{container:i,children:[v.jsx(D5,{}),v.jsxs(O5,{ref:r,className:ye("fixed inset-x-0 bottom-0 z-50 mx-auto flex w-full max-w-[min(100vw-24px,680px)] max-h-[calc(100dvh-24px)] flex-col overflow-hidden rounded-t-3xl border border-slate-200 bg-white shadow-2xl outline-none data-[state=closed]:animate-out data-[state=open]:animate-in data-[state=closed]:duration-200 data-[state=open]:duration-200 data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom sm:inset-x-auto sm:left-1/2 sm:top-1/2 sm:bottom-auto sm:-translate-x-1/2 sm:-translate-y-1/2 sm:rounded-3xl sm:border sm:shadow-xl","sm:max-w-xl lg:max-w-3xl","overflow-x-hidden",e),...n,children:[v.jsx("span",{className:"mx-auto mt-2 h-1.5 w-12 rounded-full bg-slate-300 sm:hidden","aria-hidden":"true"}),v.jsx("div",{className:"relative flex min-h-0 flex-1 flex-col",children:t}),v.jsxs(N5,{className:"absolute right-4 top-4 inline-flex h-10 w-10 items-center justify-center rounded-full bg-white/80 text-slate-500 shadow-sm ring-offset-white transition-all hover:bg-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent focus-visible:ring-offset-2",children:[v.jsx(W4,{className:"h-4 w-4"}),v.jsx("span",{className:"sr-only",children:"Cerrar"})]})]})]})});Wa.displayName=O5.displayName;const Ha=({className:e,...t})=>v.jsx("div",{className:ye("sticky top-0 z-10 flex flex-col gap-1.5 border-b border-slate-200 bg-white/95 px-6 pb-4 pt-5 text-center backdrop-blur supports-[backdrop-filter]:bg-white/80 sm:text-left",e),...t}),hs=g.forwardRef(({className:e,...t},n)=>v.jsx(k5,{ref:n,className:ye("text-lg font-semibold leading-tight text-slate-900",e),...t}));hs.displayName=k5.displayName;const ps=g.forwardRef(({className:e,...t},n)=>v.jsx(R5,{ref:n,className:ye("text-sm text-slate-500",e),...t}));ps.displayName=R5.displayName;const Ao=g.forwardRef(({className:e,...t},n)=>v.jsx("div",{ref:n,className:ye("flex-1 overflow-y-auto px-6 py-4 text-left",e),...t}));Ao.displayName="DialogBody";const ms=({className:e,...t})=>v.jsx("div",{className:ye("sticky bottom-0 z-10 flex flex-col gap-2 border-t border-slate-200 bg-white/95 px-6 py-4 backdrop-blur supports-[backdrop-filter]:bg-white/80 sm:flex-row sm:items-center sm:justify-end",e),...t});ms.displayName="DialogFooter";const Z1e=[{value:"ACTIVO",label:"Activo"},{value:"PAUSADO",label:"Pausado"}];function Q1e({defaultValues:e,onSubmit:t,submitLabel:n="Guardar cliente",onCancel:r}){const i=IS({resolver:jS(hbe),defaultValues:e??{nombre_legal:"",alias:"",rfc:"",email:"",telefono:"",direccion:"",ciudad:"",cp:"",limite_credito:0,dias_credito:0,estatus:"ACTIVO"}});g.useEffect(()=>{e&&i.reset(e)},[e,i]);const o=i.handleSubmit(async s=>{await t(s)});return v.jsxs("form",{className:"flex h-full flex-col",onSubmit:o,children:[v.jsx(Ao,{className:"space-y-5",children:v.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[v.jsxs("div",{className:"space-y-2",children:[v.jsx(fr,{htmlFor:"nombre_legal",children:"Nombre fiscal"}),v.jsx(je,{id:"nombre_legal",...i.register("nombre_legal")}),i.formState.errors.nombre_legal?v.jsx("p",{className:"text-xs text-red-600",children:i.formState.errors.nombre_legal.message}):null]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(fr,{htmlFor:"alias",children:"Alias comercial"}),v.jsx(je,{id:"alias",...i.register("alias")}),i.formState.errors.alias?v.jsx("p",{className:"text-xs text-red-600",children:i.formState.errors.alias.message}):null]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(fr,{htmlFor:"rfc",children:"RFC"}),v.jsx(je,{id:"rfc",...i.register("rfc"),className:"uppercase"}),i.formState.errors.rfc?v.jsx("p",{className:"text-xs text-red-600",children:i.formState.errors.rfc.message}):null]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(fr,{htmlFor:"email",children:"Correo"}),v.jsx(je,{id:"email",type:"email",...i.register("email")}),i.formState.errors.email?v.jsx("p",{className:"text-xs text-red-600",children:i.formState.errors.email.message}):null]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(fr,{htmlFor:"telefono",children:"Teléfono"}),v.jsx(je,{id:"telefono",...i.register("telefono"),inputMode:"numeric"}),i.formState.errors.telefono?v.jsx("p",{className:"text-xs text-red-600",children:i.formState.errors.telefono.message}):null]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(fr,{htmlFor:"ciudad",children:"Ciudad"}),v.jsx(je,{id:"ciudad",...i.register("ciudad")}),i.formState.errors.ciudad?v.jsx("p",{className:"text-xs text-red-600",children:i.formState.errors.ciudad.message}):null]}),v.jsxs("div",{className:"space-y-2 md:col-span-2",children:[v.jsx(fr,{htmlFor:"direccion",children:"Dirección"}),v.jsx(je,{id:"direccion",...i.register("direccion")}),i.formState.errors.direccion?v.jsx("p",{className:"text-xs text-red-600",children:i.formState.errors.direccion.message}):null]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(fr,{htmlFor:"cp",children:"Código Postal"}),v.jsx(je,{id:"cp",...i.register("cp")}),i.formState.errors.cp?v.jsx("p",{className:"text-xs text-red-600",children:i.formState.errors.cp.message}):null]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(fr,{htmlFor:"limite_credito",children:"Límite de crédito"}),v.jsx(je,{id:"limite_credito",type:"number",step:"0.01",...i.register("limite_credito",{valueAsNumber:!0})}),i.formState.errors.limite_credito?v.jsx("p",{className:"text-xs text-red-600",children:i.formState.errors.limite_credito.message}):null]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(fr,{htmlFor:"dias_credito",children:"Días de crédito"}),v.jsx(je,{id:"dias_credito",type:"number",...i.register("dias_credito",{valueAsNumber:!0})}),i.formState.errors.dias_credito?v.jsx("p",{className:"text-xs text-red-600",children:i.formState.errors.dias_credito.message}):null]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(fr,{children:"Estatus"}),v.jsx(R1e,{value:i.watch("estatus"),onValueChange:s=>i.setValue("estatus",s),children:Z1e.map(s=>v.jsx(N1e,{value:s.value,children:s.label},s.value))})]})]})}),v.jsxs(ms,{className:"gap-3 sm:justify-between",children:[v.jsx(Ba,{asChild:!0,children:v.jsx(Ne,{type:"button",variant:"ghost",className:"w-full sm:w-auto",onClick:r,children:"Cancelar"})}),v.jsx(Ne,{type:"submit",className:"w-full sm:w-auto",disabled:i.formState.isSubmitting,children:i.formState.isSubmitting?"Guardando...":n})]})]})}lr(Tt,"clientes");lr(Tt,"pedidos");lr(Tt,"abonos");const X1e=lr(Tt,"movimientos_caja"),J1e=lr(Tt,"bitacora");function eSe(e){return lr(Tt,"pedidos",e,"pedido_items")}async function Sr(e){await tf(J1e,{...e,timestamp:jn()})}const Dw=lr(Tt,"clientes");async function tSe(e){const t=[];e!=null&&e.estatus&&e.estatus!=="TODOS"&&t.push(Hn("estatus","==",e.estatus)),e!=null&&e.ciudad&&t.push(Hn("ciudad","==",e.ciudad));const n=aa(Dw,...t,Sp("nombre_legal")),i=(await la(n)).docs.map(o=>({id:o.id,...o.data()}));if(e!=null&&e.search){const o=e.search.toLowerCase();return i.filter(s=>[s.nombre_legal,s.alias,s.email,s.ciudad].some(a=>a.toLowerCase().includes(o)))}return i}async function nSe(e,t){const n={...e,creado_en:jn(),actualizado_en:jn()},r=await tf(Dw,n);return await Sr({entidad:"clientes",entidad_id:r.id,accion:"CREAR",usuario:t,datos:n}),r.id}async function rSe(e,t,n){const r=xn(Dw,e),i={...t,actualizado_en:jn()};await T0(r,i),await Sr({entidad:"clientes",entidad_id:e,accion:"ACTUALIZAR",usuario:n,datos:i})}async function iSe(e,t){await DA(xn(Dw,e)),await Sr({entidad:"clientes",entidad_id:e,accion:"ELIMINAR",usuario:t,datos:{}})}const Mw=["clientes"];function M5(e={},t={}){return bf({queryKey:[...Mw,e],queryFn:()=>tSe(e),staleTime:1e3*60,enabled:t.enabled})}function oSe(){const e=Ar();return wi({mutationFn:t=>nSe(t.data,t.usuarioId),onSuccess:()=>e.invalidateQueries({queryKey:Mw})})}function sSe(){const e=Ar();return wi({mutationFn:t=>rSe(t.id,t.data,t.usuarioId),onSuccess:()=>e.invalidateQueries({queryKey:Mw})})}function aSe(){const e=Ar();return wi({mutationFn:t=>iSe(t.id,t.usuarioId),onSuccess:()=>e.invalidateQueries({queryKey:Mw})})}const Hp=lr(Tt,"pedidos");async function lSe(e){const t=[];e!=null&&e.status&&e.status!=="TODOS"&&t.push(Hn("status","==",e.status)),e!=null&&e.prioridad&&e.prioridad!=="TODAS"&&t.push(Hn("prioridad","==",e.prioridad)),e!=null&&e.clienteId&&t.push(Hn("cliente_id","==",xn(Tt,"clientes",e.clienteId)));const n=aa(Hp,...t,Sp("fecha_compromiso","desc"),P4(100));return(await la(n)).docs.map(i=>({id:i.id,...i.data()}))}function uSe(e,t){return{folio:e.folio,cliente_id:xn(Tt,"clientes",e.cliente_id),fecha_pedido:Le.fromDate(e.fecha_pedido),fecha_compromiso:Le.fromDate(e.fecha_compromiso),status:e.status,anticipo:e.anticipo,subtotal:e.subtotal,descuento:e.descuento,impuestos:e.impuestos,total:e.total,saldo:e.saldo,prioridad:e.prioridad,notas:e.notas??"",creado_por:t,creado_en:jn(),actualizado_en:jn()}}async function cSe(e,t){const n=uSe(e,t),r=await tf(Hp,n),i=oie(Tt);if(e.items.forEach(o=>{const s=o.cantidad*o.precio_unitario,a=xn(eSe(r.id));i.set(a,{descripcion_item:o.descripcion_item,prenda:o.prenda,talla:o.talla,color_prenda:o.color_prenda,ubicacion:o.ubicacion,puntadas_estimadas:o.puntadas_estimadas,cantidad:o.cantidad,precio_unitario:o.precio_unitario,importe:s,observaciones:o.observaciones??""})}),await i.commit(),e.anticipo>0){const o={fecha:Le.fromDate(e.fecha_pedido),tipo:"INGRESO",categoria:"ANTICIPO",monto:e.anticipo,referencia_pedido_id:r,notas:"Anticipo registrado al crear pedido",registrado_por:t,creado_en:jn()},s=await tf(X1e,o);await Sr({entidad:"movimientos_caja",entidad_id:s.id,accion:"CREAR",usuario:t,datos:o})}return await Sr({entidad:"pedidos",entidad_id:r.id,accion:"CREAR",usuario:t,datos:n}),r.id}async function fSe(e,t,n){const r=xn(Hp,e),i={...t,actualizado_en:jn()};t.fecha_pedido?i.fecha_pedido=Le.fromDate(t.fecha_pedido):delete i.fecha_pedido,t.fecha_compromiso?i.fecha_compromiso=Le.fromDate(t.fecha_compromiso):delete i.fecha_compromiso,await T0(r,i),await Sr({entidad:"pedidos",entidad_id:e,accion:"ACTUALIZAR",usuario:n,datos:i})}async function dSe(e,t,n,r={}){const i=xn(Hp,e),o={status:t,actualizado_en:jn()};if(await T0(i,o),r.estado){const s=lr(Tt,"pedidos",e,"produccion_eventos");await tf(s,{estado:r.estado,responsable:r.responsable??n,fecha_inicio:r.fecha_inicio??jn(),fecha_fin:r.fecha_fin??null,evidencia_url:r.evidencia_url??"",notas:r.notas??""})}await Sr({entidad:"pedidos",entidad_id:e,accion:`CAMBIO_ESTADO_${t}`,usuario:n,datos:o})}async function hSe(e,t){await DA(xn(Hp,e)),await Sr({entidad:"pedidos",entidad_id:e,accion:"ELIMINAR",usuario:t,datos:{}})}const Kp=["pedidos"];function j5(e={},t={}){return bf({queryKey:[...Kp,e],queryFn:()=>lSe(e),staleTime:1e3*30,enabled:t.enabled})}function pSe(){const e=Ar();return wi({mutationFn:t=>cSe(t.data,t.usuarioId),onSuccess:()=>e.invalidateQueries({queryKey:Kp})})}function L5(){const e=Ar();return wi({mutationFn:t=>fSe(t.id,t.data,t.usuarioId),onSuccess:()=>e.invalidateQueries({queryKey:Kp})})}function mSe(){const e=Ar();return wi({mutationFn:t=>dSe(t.id,t.estado,t.usuarioId,t.data),onSuccess:()=>e.invalidateQueries({queryKey:Kp})})}function $5(){const e=Ar();return wi({mutationFn:t=>hSe(t.id,t.usuarioId),onSuccess:()=>e.invalidateQueries({queryKey:Kp})})}var Eb="rovingFocusGroup.onEntryFocus",gSe={bubbles:!1,cancelable:!0},qp="RovingFocusGroup",[h1,F5,vSe]=aB(qp),[ySe,V5]=zf(qp,[vSe]),[wSe,_Se]=ySe(qp),z5=g.forwardRef((e,t)=>v.jsx(h1.Provider,{scope:e.__scopeRovingFocusGroup,children:v.jsx(h1.Slot,{scope:e.__scopeRovingFocusGroup,children:v.jsx(bSe,{...e,ref:t})})}));z5.displayName=qp;var bSe=g.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:n,orientation:r,loop:i=!1,dir:o,currentTabStopId:s,defaultCurrentTabStopId:a,onCurrentTabStopIdChange:l,onEntryFocus:u,preventScrollOnEntryFocus:c=!1,...f}=e,d=g.useRef(null),p=Ft(t,d),y=wP(o),[m,w]=Yh({prop:s,defaultProp:a??null,onChange:l,caller:qp}),[_,b]=g.useState(!1),x=Va(u),T=F5(n),C=g.useRef(!1),[I,S]=g.useState(0);return g.useEffect(()=>{const A=d.current;if(A)return A.addEventListener(Eb,x),()=>A.removeEventListener(Eb,x)},[x]),v.jsx(wSe,{scope:n,orientation:r,dir:y,loop:i,currentTabStopId:m,onItemFocus:g.useCallback(A=>w(A),[w]),onItemShiftTab:g.useCallback(()=>b(!0),[]),onFocusableItemAdd:g.useCallback(()=>S(A=>A+1),[]),onFocusableItemRemove:g.useCallback(()=>S(A=>A-1),[]),children:v.jsx(Ye.div,{tabIndex:_||I===0?-1:0,"data-orientation":r,...f,ref:p,style:{outline:"none",...e.style},onMouseDown:He(e.onMouseDown,()=>{C.current=!0}),onFocus:He(e.onFocus,A=>{const O=!C.current;if(A.target===A.currentTarget&&O&&!_){const R=new CustomEvent(Eb,gSe);if(A.currentTarget.dispatchEvent(R),!R.defaultPrevented){const k=T().filter(j=>j.focusable),D=k.find(j=>j.active),N=k.find(j=>j.id===m),B=[D,N,...k].filter(Boolean).map(j=>j.ref.current);W5(B,c)}}C.current=!1}),onBlur:He(e.onBlur,()=>b(!1))})})}),U5="RovingFocusGroupItem",B5=g.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:n,focusable:r=!0,active:i=!1,tabStopId:o,children:s,...a}=e,l=Ca(),u=o||l,c=_Se(U5,n),f=c.currentTabStopId===u,d=F5(n),{onFocusableItemAdd:p,onFocusableItemRemove:y,currentTabStopId:m}=c;return g.useEffect(()=>{if(r)return p(),()=>y()},[r,p,y]),v.jsx(h1.ItemSlot,{scope:n,id:u,focusable:r,active:i,children:v.jsx(Ye.span,{tabIndex:f?0:-1,"data-orientation":c.orientation,...a,ref:t,onMouseDown:He(e.onMouseDown,w=>{r?c.onItemFocus(u):w.preventDefault()}),onFocus:He(e.onFocus,()=>c.onItemFocus(u)),onKeyDown:He(e.onKeyDown,w=>{if(w.key==="Tab"&&w.shiftKey){c.onItemShiftTab();return}if(w.target!==w.currentTarget)return;const _=SSe(w,c.orientation,c.dir);if(_!==void 0){if(w.metaKey||w.ctrlKey||w.altKey||w.shiftKey)return;w.preventDefault();let x=d().filter(T=>T.focusable).map(T=>T.ref.current);if(_==="last")x.reverse();else if(_==="prev"||_==="next"){_==="prev"&&x.reverse();const T=x.indexOf(w.currentTarget);x=c.loop?ASe(x,T+1):x.slice(T+1)}setTimeout(()=>W5(x))}}),children:typeof s=="function"?s({isCurrentTabStop:f,hasTabStop:m!=null}):s})})});B5.displayName=U5;var xSe={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function ESe(e,t){return t!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function SSe(e,t,n){const r=ESe(e.key,n);if(!(t==="vertical"&&["ArrowLeft","ArrowRight"].includes(r))&&!(t==="horizontal"&&["ArrowUp","ArrowDown"].includes(r)))return xSe[r]}function W5(e,t=!1){const n=document.activeElement;for(const r of e)if(r===n||(r.focus({preventScroll:t}),document.activeElement!==n))return}function ASe(e,t){return e.map((n,r)=>e[(t+r)%e.length])}var TSe=z5,PSe=B5,jw="Tabs",[CSe]=zf(jw,[V5]),H5=V5(),[ISe,jP]=CSe(jw),K5=g.forwardRef((e,t)=>{const{__scopeTabs:n,value:r,onValueChange:i,defaultValue:o,orientation:s="horizontal",dir:a,activationMode:l="automatic",...u}=e,c=wP(a),[f,d]=Yh({prop:r,onChange:i,defaultProp:o??"",caller:jw});return v.jsx(ISe,{scope:n,baseId:Ca(),value:f,onValueChange:d,orientation:s,dir:c,activationMode:l,children:v.jsx(Ye.div,{dir:c,"data-orientation":s,...u,ref:t})})});K5.displayName=jw;var q5="TabsList",G5=g.forwardRef((e,t)=>{const{__scopeTabs:n,loop:r=!0,...i}=e,o=jP(q5,n),s=H5(n);return v.jsx(TSe,{asChild:!0,...s,orientation:o.orientation,dir:o.dir,loop:r,children:v.jsx(Ye.div,{role:"tablist","aria-orientation":o.orientation,...i,ref:t})})});G5.displayName=q5;var Y5="TabsTrigger",Z5=g.forwardRef((e,t)=>{const{__scopeTabs:n,value:r,disabled:i=!1,...o}=e,s=jP(Y5,n),a=H5(n),l=J5(s.baseId,r),u=e9(s.baseId,r),c=r===s.value;return v.jsx(PSe,{asChild:!0,...a,focusable:!i,active:c,children:v.jsx(Ye.button,{type:"button",role:"tab","aria-selected":c,"aria-controls":u,"data-state":c?"active":"inactive","data-disabled":i?"":void 0,disabled:i,id:l,...o,ref:t,onMouseDown:He(e.onMouseDown,f=>{!i&&f.button===0&&f.ctrlKey===!1?s.onValueChange(r):f.preventDefault()}),onKeyDown:He(e.onKeyDown,f=>{[" ","Enter"].includes(f.key)&&s.onValueChange(r)}),onFocus:He(e.onFocus,()=>{const f=s.activationMode!=="manual";!c&&!i&&f&&s.onValueChange(r)})})})});Z5.displayName=Y5;var Q5="TabsContent",X5=g.forwardRef((e,t)=>{const{__scopeTabs:n,value:r,forceMount:i,children:o,...s}=e,a=jP(Q5,n),l=J5(a.baseId,r),u=e9(a.baseId,r),c=r===a.value,f=g.useRef(c);return g.useEffect(()=>{const d=requestAnimationFrame(()=>f.current=!1);return()=>cancelAnimationFrame(d)},[]),v.jsx(Wp,{present:i||c,children:({present:d})=>v.jsx(Ye.div,{"data-state":c?"active":"inactive","data-orientation":a.orientation,role:"tabpanel","aria-labelledby":l,hidden:!d,id:u,tabIndex:0,...s,ref:t,style:{...e.style,animationDuration:f.current?"0s":void 0},children:d&&o})})});X5.displayName=Q5;function J5(e,t){return`${e}-trigger-${t}`}function e9(e,t){return`${e}-content-${t}`}var OSe=K5,t9=G5,n9=Z5,r9=X5;const kSe=OSe,i9=g.forwardRef(({className:e,...t},n)=>v.jsx(t9,{ref:n,className:ye("inline-flex h-10 items-center justify-center rounded-md bg-slate-100 p-1 text-slate-500",e),...t}));i9.displayName=t9.displayName;const $g=g.forwardRef(({className:e,...t},n)=>v.jsx(n9,{ref:n,className:ye("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-white transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent focus-visible:ring-offset-2 data-[state=active]:bg-white data-[state=active]:text-slate-900",e),...t}));$g.displayName=n9.displayName;const Fg=g.forwardRef(({className:e,...t},n)=>v.jsx(r9,{ref:n,className:ye("mt-4 ring-offset-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent focus-visible:ring-offset-2",e),...t}));Fg.displayName=r9.displayName;const RSe=["TODOS","ACTIVO","PAUSADO"];function NSe(){const{role:e,user:t,loading:n}=To(),[r,i]=g.useState(""),[o,s]=g.useState("TODOS"),a=!!t&&!n,{data:l,isLoading:u,isFetching:c}=M5({search:r,estatus:o},{enabled:a}),f=n||u||a&&c&&!l,d=oSe(),p=sSe(),y=aSe(),[m,w]=g.useState(null),[_,b]=g.useState(!1),[x,T]=g.useState(!1),C=["OWNER","ADMIN","VENTAS"].includes(e??""),I=g.useMemo(()=>l?Array.from(new Set(l.map(j=>j.ciudad))).sort():[],[l]),[S,A]=g.useState(""),O=g.useMemo(()=>l?l.filter(j=>S?j.ciudad===S:!0):[],[l,S]);async function R(j){t&&(await d.mutateAsync({data:j,usuarioId:t.uid}),b(!1))}async function k(j){!t||!m||(await p.mutateAsync({id:m.id,data:j,usuarioId:t.uid}),b(!1))}async function D(j){t&&confirm(`¿Eliminar al cliente ${j.alias}?`)&&(await y.mutateAsync({id:j.id,usuarioId:t.uid}),T(!1))}function N(){w(null),b(!0)}function V(j){w(j),b(!0)}function B(j){w(j),T(!0)}return v.jsxs("div",{className:"relative space-y-6 pb-20",children:[v.jsxs(Lt,{className:"border-none bg-white/80 shadow-sm",children:[v.jsxs(os,{className:"pb-3",children:[v.jsx(ss,{className:"text-base font-semibold",children:"Clientes"}),v.jsx("p",{className:"text-xs text-slate-500",children:"Gestiona tus clientes desde una vista táctil y rápida."})]}),v.jsxs(Ur,{className:"space-y-4",children:[v.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:gap-4",children:[v.jsxs("div",{className:"relative w-full sm:flex-1",children:[v.jsx(voe,{className:"absolute left-4 top-1/2 h-4 w-4 -translate-y-1/2 text-slate-400"}),v.jsx(je,{placeholder:"Buscar por nombre, alias, correo o ciudad",className:"pl-11",value:r,onChange:j=>i(j.target.value)})]}),v.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-end sm:gap-3",children:[v.jsx(Gie,{className:"hidden h-4 w-4 text-slate-400 sm:block"}),v.jsx("select",{value:o,onChange:j=>s(j.target.value),className:"h-11 w-full rounded-full border border-slate-200 bg-white px-4 text-sm shadow-sm focus:outline-none focus:ring-2 focus:ring-accent sm:w-auto",children:RSe.map(j=>v.jsx("option",{value:j,children:j},j))}),v.jsxs("select",{value:S,onChange:j=>A(j.target.value),className:"h-11 w-full rounded-full border border-slate-200 bg-white px-4 text-sm shadow-sm focus:outline-none focus:ring-2 focus:ring-accent sm:w-auto",children:[v.jsx("option",{value:"",children:"Todas las ciudades"}),I.map(j=>v.jsx("option",{value:j,children:j},j))]})]})]}),C?v.jsxs(Ne,{onClick:N,className:"hidden w-full sm:w-auto lg:flex lg:self-end",children:[v.jsx(rf,{className:"h-4 w-4"}),v.jsx("span",{children:"Nuevo cliente"})]}):null]})]}),v.jsx("section",{className:"space-y-3",children:f?Array.from({length:3}).map((j,H)=>v.jsx(Lt,{className:"border-none bg-white/60 p-4 shadow-sm",children:v.jsxs("div",{className:"flex animate-pulse flex-col gap-3",children:[v.jsx("div",{className:"h-4 w-32 rounded-full bg-slate-200"}),v.jsx("div",{className:"h-4 w-48 rounded-full bg-slate-200"}),v.jsx("div",{className:"h-10 w-full rounded-full bg-slate-200"})]})},H)):O.length?O.map(j=>v.jsx(DSe,{cliente:j,onOpenDetalle:()=>B(j),onOpenEditar:()=>V(j),onEliminar:()=>D(j),canEdit:C},j.id)):v.jsx(Ta,{title:"Sin clientes",description:"Agrega tu primer cliente para comenzar a registrar pedidos y cobranza."})}),C?v.jsx(Ne,{size:"fab",className:"fixed bottom-24 right-6 z-40 lg:hidden",onClick:N,"aria-label":"Nuevo cliente",children:v.jsx(rf,{className:"h-6 w-6"})}):null,v.jsx(_u,{open:_,onOpenChange:b,children:v.jsxs(Wa,{children:[v.jsxs(Ha,{children:[v.jsx(hs,{children:m?"Editar cliente":"Nuevo cliente"}),v.jsx(ps,{children:m?"Actualiza los datos del cliente y guarda los cambios registrados.":"Completa la información para registrar un nuevo cliente en el sistema."})]}),v.jsx(Q1e,{defaultValues:m??void 0,onSubmit:m?k:R,submitLabel:m?"Actualizar cliente":"Crear cliente",onCancel:()=>b(!1)})]})}),v.jsx(_u,{open:x,onOpenChange:T,children:v.jsx(Wa,{children:m?v.jsxs(v.Fragment,{children:[v.jsxs(Ha,{className:"items-start text-left",children:[v.jsx(hs,{className:"text-xl",children:m.alias}),v.jsx(ps,{children:m.nombre_legal})]}),v.jsx(MSe,{cliente:m,puedeEliminar:C,onEliminar:D})]}):null})})]})}function DSe({cliente:e,onOpenDetalle:t,onOpenEditar:n,onEliminar:r,canEdit:i}){const o=e.estatus==="ACTIVO"?"success":"warning";return v.jsxs(Lt,{className:"relative cursor-pointer border-none bg-white/90 p-4 shadow-sm transition-transform hover:-translate-y-1 hover:shadow-md",onClick:t,children:[v.jsxs("div",{className:"flex items-start justify-between gap-3",children:[v.jsxs("div",{className:"space-y-2",children:[v.jsxs("div",{className:"flex items-center gap-2",children:[v.jsx("span",{className:"text-base font-semibold text-slate-900",children:e.alias}),v.jsx(Kr,{variant:o,children:e.estatus})]}),v.jsx("p",{className:"text-sm text-slate-500",children:e.nombre_legal})]}),i?v.jsxs("div",{className:"flex items-center gap-2",children:[v.jsx(Ne,{size:"icon",variant:"ghost",className:"h-10 w-10 border border-slate-200",onClick:s=>{s.stopPropagation(),n()},"aria-label":"Editar cliente",children:v.jsx(C0,{className:"h-4 w-4"})}),v.jsx(Ne,{size:"icon",variant:"ghost",className:"h-10 w-10 border border-slate-200 text-destructive",onClick:s=>{s.stopPropagation(),r()},"aria-label":"Eliminar cliente",children:v.jsx(Tp,{className:"h-4 w-4"})})]}):null]}),v.jsxs("div",{className:"mt-4 space-y-3 text-sm text-slate-600",children:[v.jsxs("div",{className:"flex flex-col gap-2 text-slate-600 sm:flex-row sm:flex-wrap sm:items-center",children:[v.jsxs("span",{className:"flex items-center gap-2 text-slate-600",children:[v.jsx(roe,{className:"h-4 w-4 text-slate-400"}),e.email]}),v.jsxs("span",{className:"flex items-center gap-2 text-slate-600",children:[v.jsx(doe,{className:"h-4 w-4 text-slate-400"}),G4(e.telefono)]})]}),v.jsxs("div",{className:"flex flex-col gap-2 text-xs text-slate-500 sm:flex-row sm:flex-wrap sm:items-center",children:[v.jsxs("span",{className:"flex items-center gap-2 text-slate-500",children:[v.jsx(ooe,{className:"h-4 w-4 text-slate-400"}),e.ciudad]}),v.jsxs("span",{className:"flex items-center gap-2 text-slate-500",children:[v.jsx(Bie,{className:"h-4 w-4 text-slate-400"}),nt(e.limite_credito)," límite"]})]})]})]})}function MSe({cliente:e,puedeEliminar:t,onEliminar:n}){const{user:r,loading:i}=To(),o=!!r&&!i,{data:s}=j5({clienteId:e.id},{enabled:o}),a=g.useMemo(()=>s?s.reduce((l,u)=>l+u.saldo,0):0,[s]);return v.jsxs(v.Fragment,{children:[v.jsx(Ao,{className:"space-y-6",children:v.jsxs(kSe,{defaultValue:"datos",className:"w-full",children:[v.jsxs(i9,{className:"grid w-full grid-cols-3 rounded-full bg-slate-100 p-1 text-xs",children:[v.jsx($g,{value:"datos",className:"rounded-full",children:"Datos"}),v.jsx($g,{value:"pedidos",className:"rounded-full",children:"Pedidos"}),v.jsx($g,{value:"saldos",className:"rounded-full",children:"Saldos"})]}),v.jsxs(Fg,{value:"datos",className:"mt-4 space-y-3 text-sm",children:[v.jsx(ml,{label:"RFC",value:e.rfc}),v.jsx(ml,{label:"Correo",value:e.email}),v.jsx(ml,{label:"Teléfono",value:G4(e.telefono)}),v.jsx(ml,{label:"Ciudad",value:`${e.ciudad} · CP ${e.cp}`}),v.jsx(ml,{label:"Dirección",value:e.direccion}),v.jsx(ml,{label:"Límite de crédito",value:nt(e.limite_credito)}),v.jsx(ml,{label:"Días de crédito",value:`${e.dias_credito} días`})]}),v.jsx(Fg,{value:"pedidos",className:"mt-4 space-y-3",children:s&&s.length?s.map(l=>v.jsxs("div",{className:"rounded-2xl border border-slate-200 p-4",children:[v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsxs("div",{children:[v.jsxs("p",{className:"text-sm font-semibold",children:["Folio ",l.folio]}),v.jsxs("p",{className:"text-xs text-slate-500",children:["Estado: ",l.status]})]}),v.jsx(Kr,{variant:l.saldo>0?"warning":"success",children:nt(l.saldo)})]}),v.jsxs("p",{className:"mt-2 text-xs text-slate-500",children:["Entrega: ",Je(l.fecha_compromiso.toDate()).format("DD MMM YYYY")]})]},l.id)):v.jsx(Ta,{title:"Sin pedidos",description:"Aún no hay pedidos registrados para este cliente."})}),v.jsx(Fg,{value:"saldos",className:"mt-4",children:v.jsx(Bl,{variant:a>0?"warning":"success",title:a>0?"Saldo pendiente":"Cliente al corriente",description:`Saldo total: ${nt(a)}`})})]})}),v.jsxs(ms,{className:"gap-3 sm:justify-between",children:[v.jsx(Ba,{asChild:!0,children:v.jsx(Ne,{type:"button",variant:"ghost",className:"w-full sm:w-auto",children:"Cerrar"})}),t?v.jsxs(Ne,{variant:"destructive",className:"w-full sm:w-auto",onClick:()=>n(e),children:[v.jsx(Tp,{className:"h-4 w-4"}),v.jsx("span",{children:"Eliminar"})]}):null]})]})}function ml({label:e,value:t}){return v.jsxs("div",{className:"flex flex-col gap-1 rounded-2xl bg-slate-50 p-3 text-slate-600",children:[v.jsx("span",{className:"text-[11px] uppercase tracking-wide text-slate-400",children:e}),v.jsx("span",{className:"text-sm font-medium text-slate-800",children:t})]})}const p1=xn(Tt,"configuracion","general");async function jSe(){const e=await Xre(p1);if(!e.exists()){const n={porcentaje_anticipo:50,dias_credito:30,politicas_credito:"Pagar 50% de anticipo para aprobar pedido.",roles_visibles:["OWNER","ADMIN","VENTAS","PRODUCCION","COBRANZA"]};return await O4(p1,{...n,actualizado_en:jn()}),n}return e.data()}async function LSe(e,t){await O4(p1,{...e,actualizado_en:jn()},{merge:!0}),await Sr({entidad:"configuracion",entidad_id:"general",accion:"ACTUALIZAR",usuario:t,datos:e})}const o9=["configuracion"];function s9(e={}){return bf({queryKey:o9,queryFn:jSe,staleTime:1e3*60*5,enabled:e.enabled})}function $Se(){const e=Ar();return wi({mutationFn:t=>LSe(t.data,t.usuarioId),onSuccess:()=>e.invalidateQueries({queryKey:o9})})}const Hf=g.forwardRef(({className:e,...t},n)=>v.jsx("textarea",{ref:n,className:ye("flex min-h-[112px] w-full rounded-3xl border border-slate-200 bg-white px-4 py-3 text-base ring-offset-white placeholder:text-slate-400 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),...t}));Hf.displayName="Textarea";const FSe=["COTIZACIÓN","APROBADO","DIGITIZADO","EN_PRODUCCIÓN","CALIDAD","LISTO_ENTREGA","ENTREGADO","CERRADO","CANCELADO"],VSe=["BAJA","MEDIA","ALTA"];function a9({open:e,pedido:t,onOpenChange:n,onSubmit:r,onDelete:i,isSubmitting:o=!1,isDeleting:s=!1,allowDelete:a=!0}){const[l,u]=g.useState("COTIZACIÓN"),[c,f]=g.useState("MEDIA"),[d,p]=g.useState(()=>Je().format("YYYY-MM-DD")),[y,m]=g.useState("");g.useEffect(()=>{t&&(u(t.status),f(t.prioridad),p(Je(t.fecha_compromiso.toDate()).format("YYYY-MM-DD")),m(t.notas??""))},[t]);const w=g.useMemo(()=>o||s,[o,s]);async function _(x){x.preventDefault(),!(!t||o)&&await r({status:l,prioridad:c,fecha_compromiso:Je(d).toDate(),notas:y})}async function b(){!t||!i||s||await i()}return v.jsx(_u,{open:e,onOpenChange:n,children:v.jsx(Wa,{children:t?v.jsxs("form",{onSubmit:_,className:"flex flex-col",children:[v.jsxs(Ha,{children:[v.jsxs(hs,{children:["Editar pedido ",t.folio]}),v.jsx(ps,{children:"Actualiza el estado, prioridad o fecha compromiso del pedido seleccionado."})]}),v.jsxs(Ao,{className:"space-y-4 text-sm",children:[v.jsxs("label",{className:"flex flex-col gap-1",children:["Estado",v.jsx("select",{className:"h-12 rounded-full border border-slate-200 bg-white px-4 text-base shadow-sm focus:outline-none focus:ring-2 focus:ring-accent",value:l,onChange:x=>u(x.target.value),disabled:w,children:FSe.map(x=>v.jsx("option",{value:x,children:x.replace(/_/g," ")},x))})]}),v.jsxs("label",{className:"flex flex-col gap-1",children:["Prioridad",v.jsx("select",{className:"h-12 rounded-full border border-slate-200 bg-white px-4 text-base shadow-sm focus:outline-none focus:ring-2 focus:ring-accent",value:c,onChange:x=>f(x.target.value),disabled:w,children:VSe.map(x=>v.jsx("option",{value:x,children:x},x))})]}),v.jsxs("label",{className:"flex flex-col gap-1",children:["Fecha compromiso",v.jsx(je,{type:"date",value:d,onChange:x=>p(x.target.value),disabled:w})]}),v.jsxs("label",{className:"flex flex-col gap-1",children:["Notas internas",v.jsx(Hf,{rows:4,value:y,onChange:x=>m(x.target.value),disabled:w,placeholder:"Actualiza las notas visibles para el equipo."})]})]}),v.jsxs(ms,{className:"gap-3 sm:justify-between",children:[v.jsx(Ba,{asChild:!0,children:v.jsx(Ne,{type:"button",variant:"ghost",className:"w-full sm:w-auto",disabled:w,children:"Cancelar"})}),v.jsxs("div",{className:"flex w-full flex-col gap-2 sm:w-auto sm:flex-row",children:[a&&i?v.jsx(Ne,{type:"button",variant:"destructive",className:"w-full sm:w-auto",onClick:b,disabled:w,children:s?"Eliminando...":"Eliminar"}):null,v.jsx(Ne,{type:"submit",className:"w-full sm:w-auto",disabled:w,children:o?"Guardando...":"Guardar cambios"})]})]})]}):null})})}const C2=["COTIZACIÓN","APROBADO","DIGITIZADO","EN_PRODUCCIÓN","CALIDAD","LISTO_ENTREGA","ENTREGADO","CERRADO","CANCELADO"],zSe=["BAJA","MEDIA","ALTA"],USe={COTIZACIÓN:"neutral",APROBADO:"warning",DIGITIZADO:"warning",EN_PRODUCCIÓN:"warning",CALIDAD:"warning",LISTO_ENTREGA:"success",ENTREGADO:"success",CERRADO:"success",CANCELADO:"destructive"};function BSe(){const{user:e,role:t,loading:n}=To(),r=!!e&&!n,{data:i,isLoading:o,isFetching:s}=j5({},{enabled:r}),a=n||o||r&&s&&!i,l=pSe(),u=mSe(),c=L5(),f=$5(),{data:d}=M5({},{enabled:r}),{data:p}=s9({enabled:r}),[y,m]=g.useState(!1),[w,_]=g.useState(null),[b,x]=g.useState(null),[T,C]=g.useState(!1),I=["OWNER","ADMIN","VENTAS"].includes(t??""),S=["OWNER","ADMIN","PRODUCCION"].includes(t??""),A=I;async function O(D,N){e&&await u.mutateAsync({id:D,estado:N,usuarioId:e.uid})}function R(D){x(D),C(!0)}async function k(D){e&&confirm(`¿Eliminar el pedido ${D.folio}?`)&&(await f.mutateAsync({id:D.id,usuarioId:e.uid}),(w==null?void 0:w.id)===D.id&&_(null))}return v.jsxs("div",{className:"relative space-y-6 pb-20",children:[v.jsxs(Lt,{className:"border-none bg-white/80 shadow-sm",children:[v.jsxs(os,{className:"pb-3",children:[v.jsx(ss,{className:"text-base font-semibold",children:"Pedidos"}),v.jsx("p",{className:"text-xs text-slate-500",children:"Supervisa el flujo de pedidos con una vista adaptable al tacto."})]}),v.jsxs(Ur,{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[v.jsx("div",{className:"text-xs text-slate-500",children:i!=null&&i.length?`${i.length} pedidos en seguimiento`:"Sin pedidos registrados aún"}),I?v.jsxs(Ne,{onClick:()=>{_(null),m(!0)},className:"hidden sm:inline-flex",children:[v.jsx(rf,{className:"h-4 w-4"}),v.jsx("span",{children:"Nuevo pedido"})]}):null]})]}),v.jsx("section",{className:"space-y-3",children:a?Array.from({length:3}).map((D,N)=>v.jsx(Lt,{className:"border-none bg-white/60 p-4 shadow-sm",children:v.jsxs("div",{className:"flex animate-pulse flex-col gap-3",children:[v.jsx("div",{className:"h-4 w-24 rounded-full bg-slate-200"}),v.jsx("div",{className:"h-4 w-48 rounded-full bg-slate-200"}),v.jsx("div",{className:"h-4 w-32 rounded-full bg-slate-200"})]})},N)):i&&i.length?i.map(D=>{const N=C2.indexOf(D.status),V=C2[N+1];return v.jsx(WSe,{pedido:D,onClick:()=>_(D),onAvanzar:V?()=>O(D.id,V):void 0,puedeAvanzar:!!V&&S,avanzando:u.isPending,onEdit:()=>R(D),onDelete:()=>k(D),allowActions:A},D.id)}):v.jsx(Ta,{title:"Sin pedidos",description:"Registra un nuevo pedido para comenzar el flujo de trabajo."})}),I?v.jsx(Ne,{size:"fab",className:"fixed bottom-24 right-6 z-40 sm:hidden",onClick:()=>{_(null),m(!0)},"aria-label":"Nuevo pedido",children:v.jsx(rf,{className:"h-6 w-6"})}):null,v.jsx(_u,{open:y,onOpenChange:m,children:v.jsx(Wa,{children:d&&p?v.jsx(HSe,{clientes:d,anticipoMinimo:p.porcentaje_anticipo,onSubmit:async D=>{e&&(await l.mutateAsync({data:D,usuarioId:e.uid}),m(!1))},onClose:()=>m(!1)}):v.jsx(Ao,{className:"flex h-48 items-center justify-center",children:v.jsx(U4,{className:"h-8 w-8 animate-spin text-slate-500"})})})}),v.jsx(_u,{open:!!w,onOpenChange:D=>!D&&_(null),children:v.jsx(Wa,{children:w?v.jsx(KSe,{pedido:w,onClose:()=>_(null)}):null})}),v.jsx(a9,{open:T&&!!b,pedido:b,onOpenChange:D=>{C(D),D||x(null)},onSubmit:async D=>{!e||!b||(await c.mutateAsync({id:b.id,data:D,usuarioId:e.uid}),C(!1),x(null))},onDelete:A?async()=>{b&&(await k(b),C(!1),x(null))}:void 0,isSubmitting:c.isPending,isDeleting:f.isPending,allowDelete:A})]})}function WSe({pedido:e,onClick:t,onAvanzar:n,puedeAvanzar:r,avanzando:i,onEdit:o,onDelete:s,allowActions:a}){const l=e.fecha_compromiso.toDate(),u=Je(l).diff(Je(),"day"),c=USe[e.status]??"neutral",f=e.prioridad==="ALTA"?"destructive":e.prioridad==="MEDIA"?"warning":"success";return v.jsxs(Lt,{className:"relative cursor-pointer border-none bg-white/90 p-4 shadow-sm transition-transform hover:-translate-y-1 hover:shadow-md",onClick:t,children:[v.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[v.jsxs("div",{className:"space-y-2",children:[v.jsxs("span",{className:"text-sm font-semibold text-slate-900",children:["Folio ",e.folio]}),v.jsx(Kr,{variant:c,className:"uppercase",children:e.status.replace(/_/g," ")})]}),v.jsxs("div",{className:"flex items-center gap-2",children:[v.jsx(Kr,{variant:f,className:"text-xs uppercase",children:e.prioridad}),a?v.jsxs(v.Fragment,{children:[v.jsx(Ne,{size:"icon",variant:"ghost",className:"h-10 w-10 border border-slate-200",onClick:d=>{d.stopPropagation(),o()},"aria-label":"Editar pedido",children:v.jsx(C0,{className:"h-4 w-4"})}),v.jsx(Ne,{size:"icon",variant:"ghost",className:"h-10 w-10 border border-slate-200 text-destructive",onClick:d=>{d.stopPropagation(),s()},"aria-label":"Eliminar pedido",children:v.jsx(Tp,{className:"h-4 w-4"})})]}):null]})]}),v.jsxs("div",{className:"mt-4 space-y-2 text-sm text-slate-600",children:[v.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-slate-500",children:[v.jsx(B4,{className:"h-4 w-4 text-slate-400"}),e.cliente_id.id]}),v.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:flex-wrap sm:items-center sm:justify-between",children:[v.jsxs("div",{className:"flex items-center gap-2 text-slate-500",children:[v.jsx(V4,{className:"h-4 w-4 text-slate-400"}),uu(l)]}),v.jsx(Kr,{variant:u<0?"destructive":u<=2?"warning":"success",children:u<0?`${Math.abs(u)} días vencido`:`${u} días`})]})]}),v.jsxs("div",{className:"mt-4 flex flex-col gap-3 sm:flex-row sm:flex-wrap sm:items-center sm:justify-between",children:[v.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-base font-semibold text-slate-900",children:[v.jsx(z4,{className:"h-4 w-4 text-slate-400"}),nt(e.saldo)]}),r&&n?v.jsx(Ne,{size:"icon",variant:"ghost",className:"h-10 w-10 border border-slate-200",onClick:d=>{d.stopPropagation(),n()},disabled:i,"aria-label":"Avanzar estado",children:v.jsx(Rie,{className:"h-4 w-4"})}):null]})]})}function HSe({clientes:e,anticipoMinimo:t,onSubmit:n,onClose:r}){var C;const[i,o]=g.useState(1),s=Je().startOf("day"),[a,l]=g.useState([]),[u,c]=g.useState({folio:`QB-${Je().format("YYYYMMDD-HHmm")}`,cliente_id:((C=e[0])==null?void 0:C.id)??"",fecha_pedido:s.toDate(),fecha_compromiso:s.add(7,"day").toDate(),status:"COTIZACIÓN",prioridad:"MEDIA",notas:"",anticipo:0,subtotal:0,descuento:0,impuestos:0,total:0,saldo:0}),f=g.useMemo(()=>a.reduce((I,S)=>I+S.cantidad*S.precio_unitario,0),[a]),d=g.useMemo(()=>f-u.descuento+u.impuestos,[f,u.descuento,u.impuestos]),p=g.useMemo(()=>Math.max(d-u.anticipo,0),[d,u.anticipo]),y=g.useMemo(()=>Number((d*t/100).toFixed(2)),[d,t]),m=e.length>0;function w(I,S,A){l(O=>O.map((R,k)=>k===I?{...R,[S]:S==="descripcion_item"||typeof A=="string"?A:Number(A)}:R))}function _(){l(I=>[...I,{descripcion_item:"",prenda:"",talla:"",color_prenda:"",ubicacion:"",puntadas_estimadas:0,cantidad:1,precio_unitario:0,observaciones:""}])}async function b(){if(!a.length){alert("Agrega al menos un item al pedido.");return}if(Je(u.fecha_compromiso).isBefore(s)&&!confirm("La fecha compromiso es anterior a hoy. ¿Deseas continuar?")||u.anticipo<y&&!confirm(`El anticipo es menor al ${t}% sugerido. ¿Deseas continuar?`))return;const I={...u,subtotal:f,total:d,saldo:p,items:a.map(S=>({...S,importe:S.cantidad*S.precio_unitario}))};await n(I)}const x=[{id:1,label:"Cliente"},{id:2,label:"Items"},{id:3,label:"Importes"},{id:4,label:"Confirmar"}],T=i===4;return m?v.jsxs(v.Fragment,{children:[v.jsxs(Ha,{children:[v.jsx(hs,{children:"Nuevo pedido"}),v.jsx(ps,{children:"Completa los pasos para generar el pedido y calcular los importes finales."})]}),v.jsxs(Ao,{className:"space-y-6",children:[v.jsx("div",{className:"grid grid-cols-2 gap-2 text-[11px] sm:grid-cols-4 sm:text-xs",children:x.map((I,S)=>{const A=i===I.id;return v.jsxs("div",{className:ye("flex w-full flex-col items-center gap-1 rounded-full border px-3 py-2 text-center uppercase",A?"border-primary bg-primary text-white":"border-transparent bg-slate-100 text-slate-500"),children:[v.jsx("span",{children:I.label}),S<x.length-1?v.jsxs("span",{className:"text-[10px] text-slate-400",children:["Paso ",I.id]}):null]},I.id)})}),i===1?v.jsxs("div",{className:"space-y-4",children:[v.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:["Cliente",v.jsx("select",{className:"h-12 rounded-full border border-slate-200 bg-white px-4 text-base shadow-sm focus:outline-none focus:ring-2 focus:ring-accent",value:u.cliente_id,onChange:I=>c(S=>({...S,cliente_id:I.target.value})),children:e.map(I=>v.jsxs("option",{value:I.id,children:[I.alias," - ",I.ciudad]},I.id))})]}),v.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:["Fecha de compromiso",v.jsx(je,{type:"date",value:Je(u.fecha_compromiso).format("YYYY-MM-DD"),min:s.format("YYYY-MM-DD"),onChange:I=>c(S=>({...S,fecha_compromiso:Je(I.target.value).toDate()}))})]}),v.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:["Prioridad",v.jsx("select",{className:"h-12 rounded-full border border-slate-200 bg-white px-4 text-base shadow-sm focus:outline-none focus:ring-2 focus:ring-accent",value:u.prioridad,onChange:I=>c(S=>({...S,prioridad:I.target.value})),children:zSe.map(I=>v.jsx("option",{value:I,children:I},I))})]}),v.jsx(Hf,{placeholder:"Notas generales",value:u.notas??"",onChange:I=>c(S=>({...S,notas:I.target.value}))})]}):null,i===2?v.jsxs("div",{className:"space-y-4",children:[a.map((I,S)=>v.jsxs("div",{className:"rounded-2xl border border-slate-200 p-4",children:[v.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[v.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:["Descripción libre",v.jsx(je,{value:I.descripcion_item,onChange:A=>w(S,"descripcion_item",A.target.value)})]}),v.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:["Prenda",v.jsx(je,{value:I.prenda,onChange:A=>w(S,"prenda",A.target.value)})]}),v.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:["Talla",v.jsx(je,{value:I.talla,onChange:A=>w(S,"talla",A.target.value)})]}),v.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:["Color",v.jsx(je,{value:I.color_prenda,onChange:A=>w(S,"color_prenda",A.target.value)})]}),v.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:["Ubicación",v.jsx(je,{value:I.ubicacion,onChange:A=>w(S,"ubicacion",A.target.value)})]}),v.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:["Puntadas estimadas",v.jsx(je,{type:"number",value:I.puntadas_estimadas,onChange:A=>w(S,"puntadas_estimadas",Number(A.target.value))})]}),v.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:["Cantidad",v.jsx(je,{type:"number",min:1,value:I.cantidad,onChange:A=>w(S,"cantidad",Number(A.target.value))})]}),v.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:["Precio unitario",v.jsx(je,{type:"number",step:"0.01",value:I.precio_unitario,onChange:A=>w(S,"precio_unitario",Number(A.target.value))})]})]}),v.jsxs("p",{className:"mt-2 text-xs text-slate-500",children:["Importe: ",nt(I.cantidad*I.precio_unitario)]})]},S)),v.jsx(Ne,{type:"button",variant:"outline",onClick:_,className:"w-full sm:w-auto",children:"Agregar item"})]}):null,i===3?v.jsxs("div",{className:"space-y-4",children:[v.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[v.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:["Subtotal",v.jsx(je,{type:"number",readOnly:!0,value:f.toFixed(2)})]}),v.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:["Descuento",v.jsx(je,{type:"number",step:"0.01",value:u.descuento,onChange:I=>c(S=>({...S,descuento:Number(I.target.value)}))})]}),v.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:["Impuestos",v.jsx(je,{type:"number",step:"0.01",value:u.impuestos,onChange:I=>c(S=>({...S,impuestos:Number(I.target.value)}))})]}),v.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:["Anticipo",v.jsx(je,{type:"number",step:"0.01",value:u.anticipo,onChange:I=>c(S=>({...S,anticipo:Number(I.target.value)}))}),v.jsxs("span",{className:"text-xs text-slate-500",children:["Sugerido: ",nt(y)]})]})]}),v.jsx(Bl,{variant:u.anticipo>=y?"success":"warning",title:`Total: ${nt(d)} / Saldo: ${nt(p)}`,description:`Anticipo mínimo recomendado (${t}%): ${nt(y)}`})]}):null,i===4?v.jsxs("div",{className:"space-y-4 text-sm",children:[v.jsx(Bl,{variant:"default",title:"Resumen del pedido",description:`Folio: ${u.folio} — Cliente ${u.cliente_id}`}),v.jsxs("div",{children:[v.jsx("p",{className:"font-medium text-slate-600",children:"Items"}),v.jsx("ul",{className:"mt-2 space-y-2 text-xs text-slate-600",children:a.map((I,S)=>v.jsxs("li",{className:"flex items-center justify-between",children:[v.jsxs("span",{children:[I.descripcion_item," · ",I.cantidad," x ",nt(I.precio_unitario)]}),v.jsx("span",{children:nt(I.cantidad*I.precio_unitario)})]},S))})]}),v.jsxs("div",{className:"text-xs text-slate-500",children:[v.jsxs("p",{children:["Subtotal: ",nt(f)]}),v.jsxs("p",{children:["Descuento: ",nt(u.descuento)]}),v.jsxs("p",{children:["Impuestos: ",nt(u.impuestos)]}),v.jsxs("p",{className:"font-semibold text-slate-700",children:["Total: ",nt(d)]}),v.jsxs("p",{children:["Anticipo: ",nt(u.anticipo)]}),v.jsxs("p",{children:["Saldo: ",nt(p)]})]})]}):null]}),v.jsxs(ms,{className:"gap-3 sm:justify-between",children:[v.jsxs("div",{className:"flex w-full flex-col gap-2 sm:w-auto sm:flex-row",children:[v.jsx(Ba,{asChild:!0,children:v.jsx(Ne,{type:"button",variant:"ghost",className:"w-full sm:w-auto",onClick:r,children:"Cancelar"})}),v.jsx(Ne,{type:"button",variant:"outline",className:"w-full sm:w-auto",onClick:()=>o(I=>Math.max(1,I-1)),disabled:i===1,children:"Regresar"})]}),v.jsx(Ne,{type:"button",className:"w-full sm:w-auto",onClick:T?b:()=>o(I=>I+1),disabled:!T&&i===2&&a.length===0,children:T?"Crear pedido":"Continuar"})]})]}):v.jsxs(v.Fragment,{children:[v.jsxs(Ha,{children:[v.jsx(hs,{children:"Nuevo pedido"}),v.jsx(ps,{children:"Completa los pasos para generar el pedido y calcular los importes finales."})]}),v.jsx(Ao,{className:"flex flex-1 flex-col items-center justify-center gap-4 text-center",children:v.jsx(Bl,{variant:"warning",title:"No hay clientes activos",description:"Registra un cliente para asociarlo al pedido."})}),v.jsx(ms,{children:v.jsx(Ba,{asChild:!0,children:v.jsx(Ne,{type:"button",variant:"ghost",className:"w-full sm:w-auto",onClick:r,children:"Cerrar"})})})]})}function KSe({pedido:e,onClose:t}){return v.jsxs(v.Fragment,{children:[v.jsxs(Ha,{children:[v.jsxs(hs,{children:["Detalle pedido ",e.folio]}),v.jsx(ps,{children:"Revisa la información general del pedido y su estado actual."})]}),v.jsx(Ao,{className:"space-y-4",children:v.jsxs("div",{className:"grid gap-3 text-sm md:grid-cols-2",children:[v.jsxs("div",{children:[v.jsx("p",{className:"font-medium text-slate-600",children:"Estado"}),v.jsx("p",{children:e.status})]}),v.jsxs("div",{children:[v.jsx("p",{className:"font-medium text-slate-600",children:"Saldo"}),v.jsx("p",{children:nt(e.saldo)})]}),v.jsxs("div",{children:[v.jsx("p",{className:"font-medium text-slate-600",children:"Compromiso"}),v.jsx("p",{children:uu(e.fecha_compromiso.toDate())})]}),v.jsxs("div",{children:[v.jsx("p",{className:"font-medium text-slate-600",children:"Anticipo"}),v.jsx("p",{children:nt(e.anticipo)})]}),v.jsxs("div",{className:"md:col-span-2",children:[v.jsx("p",{className:"font-medium text-slate-600",children:"Notas"}),v.jsx("p",{children:e.notas||"Sin notas"})]})]})}),v.jsx(ms,{children:v.jsx(Ba,{asChild:!0,children:v.jsx(Ne,{type:"button",variant:"ghost",className:"w-full sm:w-auto",onClick:t,children:"Cerrar"})})})]})}const qSe=lr(Tt,"pedidos"),GSe=lr(Tt,"abonos"),YSe=lr(Tt,"movimientos_caja");async function ZSe(){const e=aa(qSe,Hn("saldo",">",0),Sp("saldo","desc"));return(await la(e)).docs.map(n=>({id:n.id,...n.data()}))}async function QSe(e,t){const n=xn(Tt,"pedidos",e.pedido_id),r=xn(Tt,"clientes",e.cliente_id),i=xn(GSe),o=xn(YSe);let s=0;await iie(Tt,async a=>{const l=await a.get(n);if(!l.exists())throw new Error("Pedido no encontrado");const u=l.data();s=Math.max(u.saldo-e.monto,0),a.update(n,{saldo:s,actualizado_en:jn()}),a.set(i,{pedido_id:n,cliente_id:r,fecha:Le.fromDate(e.fecha),monto:e.monto,metodo:e.metodo,ref:e.ref??"",notas:e.notas??"",registrado_por:t,creado_en:jn()}),a.set(o,{fecha:Le.fromDate(e.fecha),tipo:"INGRESO",categoria:"COBRANZA",monto:e.monto,referencia_pedido_id:n,notas:`Abono ${e.metodo}`,registrado_por:t,creado_en:jn()})}),await Sr({entidad:"abonos",entidad_id:i.id,accion:"REGISTRAR_ABONO",usuario:t,datos:{pedidoId:n.id,monto:e.monto}}),await Sr({entidad:"pedidos",entidad_id:n.id,accion:"ACTUALIZAR_SALDO",usuario:t,datos:{saldo:s}})}const l9=["cobranza"];function XSe(e={}){return bf({queryKey:l9,queryFn:ZSe,staleTime:1e3*30,enabled:e.enabled})}function JSe(){const e=Ar();return wi({mutationFn:t=>QSe(t.data,t.usuarioId),onSuccess:()=>{e.invalidateQueries({queryKey:l9}),e.invalidateQueries({queryKey:["pedidos"]})}})}const eAe=["EFECTIVO","TRANSFERENCIA","TARJETA"];function tAe(){const{user:e,role:t,loading:n}=To(),r=!!e&&!n,{data:i,isLoading:o,isFetching:s}=XSe({enabled:r}),a=n||o||r&&s&&!i,l=JSe(),[u,c]=g.useState(null),f=L5(),d=$5(),[p,y]=g.useState(null),[m,w]=g.useState(!1),_=["OWNER","ADMIN","COBRANZA"].includes(t??"");function b(T){y(T),w(!0)}async function x(T){e&&confirm(`¿Eliminar el pedido ${T.folio}?`)&&(await d.mutateAsync({id:T.id,usuarioId:e.uid}),(u==null?void 0:u.id)===T.id&&c(null))}return v.jsxs("div",{className:"space-y-6 pb-12",children:[v.jsxs(Lt,{className:"border-none bg-white/80 shadow-sm",children:[v.jsxs(os,{className:"pb-3",children:[v.jsx(ss,{className:"text-base font-semibold",children:"Créditos y cobranza"}),v.jsx("p",{className:"text-xs text-slate-500",children:"Monitorea los pedidos con saldo pendiente y registra abonos al instante."})]}),v.jsxs(Ur,{className:"flex items-center justify-between text-xs text-slate-500",children:[v.jsx("span",{children:i!=null&&i.length?`${i.length} pedidos con saldo`:"Sin cartera vencida"}),v.jsx(Kr,{variant:"warning",className:"uppercase",children:"Revisa diariamente"})]})]}),v.jsx("section",{className:"space-y-3",children:a?Array.from({length:3}).map((T,C)=>v.jsx(Lt,{className:"border-none bg-white/60 p-4 shadow-sm",children:v.jsxs("div",{className:"flex animate-pulse flex-col gap-3",children:[v.jsx("div",{className:"h-4 w-28 rounded-full bg-slate-200"}),v.jsx("div",{className:"h-4 w-40 rounded-full bg-slate-200"})]})},C)):i&&i.length?i.map(T=>v.jsx(nAe,{pedido:T,onRegistrar:()=>c(T),disabled:!_,onEdit:()=>b(T),onDelete:()=>x(T),allowActions:_},T.id)):v.jsx(Ta,{title:"Sin cartera vencida",description:"Todos los pedidos están al corriente."})}),v.jsx(_u,{open:!!u,onOpenChange:T=>!T&&c(null),children:v.jsx(Wa,{children:u?v.jsx(rAe,{pedido:u,onClose:()=>c(null),onSubmit:async T=>{e&&(await l.mutateAsync({data:T,usuarioId:e.uid}),c(null))},isSubmitting:l.isPending}):null})}),v.jsx(a9,{open:m&&!!p,pedido:p,onOpenChange:T=>{w(T),T||y(null)},onSubmit:async T=>{!e||!p||(await f.mutateAsync({id:p.id,data:T,usuarioId:e.uid}),w(!1),y(null))},onDelete:_?async()=>{p&&(await x(p),w(!1),y(null))}:void 0,isSubmitting:f.isPending,isDeleting:d.isPending,allowDelete:_})]})}function nAe({pedido:e,onRegistrar:t,disabled:n,onEdit:r,onDelete:i,allowActions:o}){const s=e.fecha_compromiso.toDate(),a=Je().diff(s,"day"),l=Je().diff(s,"day")===0;return v.jsxs(Lt,{className:"border-none bg-white/90 p-4 shadow-sm",children:[v.jsxs("div",{className:"flex items-start justify-between gap-3",children:[v.jsxs("div",{children:[v.jsxs("p",{className:"text-sm font-semibold text-slate-900",children:["Folio ",e.folio]}),v.jsxs("div",{className:"mt-1 flex items-center gap-2 text-xs text-slate-500",children:[v.jsx(B4,{className:"h-4 w-4 text-slate-400"}),e.cliente_id.id]})]}),v.jsxs("div",{className:"flex items-center gap-2",children:[v.jsx(Kr,{variant:e.status==="CERRADO"?"success":"warning",className:"uppercase",children:e.status.replace(/_/g," ")}),o?v.jsxs(v.Fragment,{children:[v.jsx(Ne,{size:"icon",variant:"ghost",className:"h-9 w-9 border border-slate-200",onClick:r,"aria-label":"Editar pedido",children:v.jsx(C0,{className:"h-4 w-4"})}),v.jsx(Ne,{size:"icon",variant:"ghost",className:"h-9 w-9 border border-slate-200 text-destructive",onClick:i,"aria-label":"Eliminar pedido",children:v.jsx(Tp,{className:"h-4 w-4"})})]}):null]})]}),v.jsxs("div",{className:"mt-4 flex flex-col gap-2 text-sm text-slate-600",children:[v.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[v.jsxs("div",{className:"flex items-center gap-2 text-slate-500",children:[v.jsx(V4,{className:"h-4 w-4 text-slate-400"}),uu(s)]}),v.jsx(Kr,{variant:a>0?"destructive":l?"warning":"success",children:a>0?`${a} días vencido`:l?"Vence hoy":"Al día"})]}),v.jsxs("div",{className:"flex items-center gap-2 text-base font-semibold text-slate-900",children:[v.jsx(MA,{className:"h-4 w-4 text-amber-500"}),nt(e.saldo)," pendientes"]})]}),v.jsx("div",{className:"mt-4 flex flex-col gap-2 sm:flex-row sm:justify-end",children:v.jsx(Ne,{onClick:t,disabled:n,className:"w-full sm:w-auto",children:"Registrar abono"})})]})}function rAe({pedido:e,onSubmit:t,onClose:n,isSubmitting:r}){const[i,o]=g.useState(Je().format("YYYY-MM-DD")),[s,a]=g.useState(e.saldo),[l,u]=g.useState("EFECTIVO"),[c,f]=g.useState(""),[d,p]=g.useState("");async function y(m){m.preventDefault(),await t({pedido_id:e.id,cliente_id:e.cliente_id.id,fecha:Je(i).toDate(),monto:s,metodo:l,ref:c,notas:d})}return v.jsxs("form",{className:"flex h-full flex-col",onSubmit:y,children:[v.jsxs(Ha,{children:[v.jsxs(hs,{children:["Registrar abono — ",e.folio]}),v.jsx(ps,{children:"Ingresa el pago recibido y actualiza el saldo pendiente del pedido."})]}),v.jsxs(Ao,{className:"space-y-3 text-sm",children:[v.jsxs("div",{children:[v.jsx("p",{className:"font-medium text-slate-600",children:"Saldo actual"}),v.jsx("p",{children:nt(e.saldo)})]}),v.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:["Fecha",v.jsx(je,{type:"date",value:i,onChange:m=>o(m.target.value),disabled:r})]}),v.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:["Monto",v.jsx(je,{type:"number",step:"0.01",value:s,onChange:m=>a(Number(m.target.value)),disabled:r})]}),v.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:["Método de pago",v.jsx("select",{className:"h-12 rounded-full border border-slate-200 bg-white px-4 text-base shadow-sm focus:outline-none focus:ring-2 focus:ring-accent",value:l,onChange:m=>u(m.target.value),disabled:r,children:eAe.map(m=>v.jsx("option",{value:m,children:m},m))})]}),v.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:["Referencia",v.jsx(je,{value:c,onChange:m=>f(m.target.value),disabled:r})]}),v.jsx(Hf,{placeholder:"Notas",value:d,onChange:m=>p(m.target.value),disabled:r})]}),v.jsxs(ms,{className:"gap-3 sm:justify-end",children:[v.jsx(Ba,{asChild:!0,children:v.jsx(Ne,{type:"button",variant:"ghost",className:"w-full sm:w-auto",onClick:n,disabled:r,children:"Cancelar"})}),v.jsx(Ne,{type:"submit",className:"w-full sm:w-auto",disabled:r,children:r?"Guardando...":"Registrar"})]})]})}const Lw=lr(Tt,"movimientos_caja");async function iAe(e){const t=[];e!=null&&e.tipo&&e.tipo!=="TODOS"&&t.push(Hn("tipo","==",e.tipo)),e!=null&&e.categoria&&t.push(Hn("categoria","==",e.categoria)),e!=null&&e.desde&&t.push(Hn("fecha",">=",Le.fromDate(e.desde))),e!=null&&e.hasta&&t.push(Hn("fecha","<=",Le.fromDate(e.hasta)));const n=aa(Lw,...t,Sp("fecha","desc"),P4(200));return(await la(n)).docs.map(i=>({id:i.id,...i.data()}))}async function oAe(e,t){const n={fecha:Le.fromDate(e.fecha),tipo:e.tipo,categoria:e.categoria,monto:e.monto,referencia_pedido_id:e.referencia_pedido_id?xn(Tt,"pedidos",e.referencia_pedido_id):null,notas:e.notas??"",registrado_por:t,creado_en:jn()},r=await tf(Lw,n);await Sr({entidad:"movimientos_caja",entidad_id:r.id,accion:"CREAR",usuario:t,datos:n})}async function sAe(e,t,n){const r=xn(Lw,e),i={fecha:Le.fromDate(t.fecha),tipo:t.tipo,categoria:t.categoria,monto:t.monto,referencia_pedido_id:t.referencia_pedido_id?xn(Tt,"pedidos",t.referencia_pedido_id):null,notas:t.notas??"",actualizado_en:jn()};await T0(r,i),await Sr({entidad:"movimientos_caja",entidad_id:e,accion:"ACTUALIZAR",usuario:n,datos:i})}async function aAe(e,t){await DA(xn(Lw,e)),await Sr({entidad:"movimientos_caja",entidad_id:e,accion:"ELIMINAR",usuario:t,datos:{}})}const $w=["caja"];function lAe(e={},t={}){return bf({queryKey:[...$w,e],queryFn:()=>iAe(e),staleTime:1e3*30,enabled:t.enabled})}function uAe(){const e=Ar();return wi({mutationFn:t=>oAe(t.data,t.usuarioId),onSuccess:()=>e.invalidateQueries({queryKey:$w})})}function cAe(){const e=Ar();return wi({mutationFn:t=>sAe(t.id,t.data,t.usuarioId),onSuccess:()=>e.invalidateQueries({queryKey:$w})})}function fAe(){const e=Ar();return wi({mutationFn:t=>aAe(t.id,t.usuarioId),onSuccess:()=>e.invalidateQueries({queryKey:$w})})}function dAe(){var B;const{user:e,role:t,loading:n}=To(),[r,i]=g.useState("TODOS"),[o,s]=g.useState(""),[a,l]=g.useState(Je().subtract(7,"day").format("YYYY-MM-DD")),[u,c]=g.useState(Je().format("YYYY-MM-DD")),f=!!e&&!n,{data:d,isLoading:p,isFetching:y}=lAe({tipo:r,categoria:o||void 0,desde:Je(a).toDate(),hasta:Je(u).toDate()},{enabled:f}),m=n||p||f&&y&&!d,w=uAe(),_=cAe(),b=fAe(),[x,T]=g.useState(!1),[C,I]=g.useState("crear"),[S,A]=g.useState(null),O=g.useMemo(()=>{if(!d)return{ingreso:0,egreso:0,neto:0};const j=d.filter(F=>F.tipo==="INGRESO").reduce((F,U)=>F+U.monto,0),H=d.filter(F=>F.tipo==="EGRESO").reduce((F,U)=>F+U.monto,0);return{ingreso:j,egreso:H,neto:j-H}},[d]);function R(){if(!d||!d.length)return;const j=`Fecha,Tipo,Categoría,Monto,Referencia,Notas
