<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link id="favicon" rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vite + React + TS</title>
    <script>
      const redirectPath = sessionStorage.getItem('gh-spa-redirect')
      if (redirectPath) {
        sessionStorage.removeItem('gh-spa-redirect')

        try {
          const targetUrl = new URL(redirectPath, window.location.origin)
          const hasExplicitHash = targetUrl.hash && targetUrl.hash !== '#'
          const normalizedPath = targetUrl.pathname.replace(/^\//, '')
          const pathWithSearch = `${normalizedPath}${targetUrl.search}`
          const nextHash = hasExplicitHash
            ? targetUrl.hash.replace(/^#/, '')
            : pathWithSearch

          if (nextHash) {
            const hashWithLeadingSlash = nextHash.startsWith('/') ? nextHash : `/${nextHash}`
            window.location.hash = hashWithLeadingSlash
          }
        } catch (error) {
          console.warn('[SPA Redirect] Failed to parse redirect path', error)
          sessionStorage.removeItem('gh-spa-redirect')
        }
      }
    </script>
    <script>
      const isLocalhost = ['localhost', '127.0.0.1', ''].includes(location.hostname)
      const isDocsPath = location.pathname.includes('/docs/')
      const assetBase = isDocsPath ? './' : './docs/'

      const manifestState = { promise: null }
      const metaState = { promise: null }
      let stylesheetPromise = null

      const warnPrefix = '[Assets]'

      const warn = (...messages) => {
        console.warn(warnPrefix, ...messages)
      }

      const fetchJson = async (url, options = {}) => {
        const { quiet = false } = options
        try {
          const response = await fetch(url, { cache: 'no-store' })
          if (!response.ok) {
            if (!quiet) {
              warn(`Failed to fetch JSON from ${url}`, `(${response.status})`)
            }
            return null
          }
          return await response.json()
        } catch (error) {
          if (!quiet) {
            warn(`Error fetching JSON from ${url}`, error)
          }
          return null
        }
      }

      const loadManifest = async () => {
        if (isLocalhost) {
          return null
        }

        if (!manifestState.promise) {
          manifestState.promise = (async () => {
            const candidates = [`${assetBase}.vite/manifest.json`, `${assetBase}manifest.json`]
            for (const candidate of candidates) {
              const manifest = await fetchJson(candidate, { quiet: true })
              if (manifest) {
                manifestState.url = candidate
                return manifest
              }
            }

            warn('Manifest not found in expected locations')
            return null
          })()
        }

        return manifestState.promise
      }

      const loadMeta = async () => {
        if (isLocalhost) {
          return null
        }

        if (!metaState.promise) {
          metaState.promise = fetchJson('/.docs-build-meta.json')
        }

        return metaState.promise
      }

      const appendStylesheet = (href) => {
        if (document.querySelector(`link[data-app-stylesheet="${href}"]`)) {
          return
        }

        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = href
        link.dataset.appStylesheet = href
        document.head.appendChild(link)
      }

      const resolveCssUrls = async () => {
        if (isLocalhost) {
          return []
        }

        const manifest = await loadManifest()
        const entry = manifest?.['src/main.tsx']
        if (Array.isArray(entry?.css) && entry.css.length) {
          return entry.css.map((file) => `${assetBase}${file}`)
        }

        try {
          const response = await fetch(`${assetBase}index.html`, { cache: 'no-store' })
          if (response.ok) {
            const html = await response.text()
            const matches = [...html.matchAll(/href=["'](assets\/index\.[^"']+\.css)["']/gi)]
            if (matches.length) {
              return matches.map((match) => `${assetBase}${match[1]}`)
            }
          } else {
            warn('Failed to fetch docs index for CSS discovery', `(${response.status})`)
          }
        } catch (error) {
          warn('Error fetching docs index for CSS discovery', error)
        }

        return [`${assetBase}assets/main.css`]
      }

      const ensureStylesheets = async () => {
        if (stylesheetPromise) {
          return stylesheetPromise
        }

        stylesheetPromise = (async () => {
          const cssUrls = await resolveCssUrls()
          cssUrls.forEach((href) => {
            appendStylesheet(href)
          })
        })()

        return stylesheetPromise
      }

      const resolveMainModule = async () => {
        if (isLocalhost) {
          return '/src/main.tsx'
        }

        const manifest = await loadManifest()
        const entry = manifest?.['src/main.tsx']
        if (entry?.file) {
          return `${assetBase}${entry.file}`
        }

        const meta = await loadMeta()
        if (meta?.main) {
          return `${assetBase}assets/${meta.main}`
        }

        return `${assetBase}assets/main.js`
      }

      window.__APP_BOOTSTRAP__ = {
        isLocalhost,
        isDocsPath,
        assetBase,
        ensureStylesheets,
        resolveMainModule,
      }

      if (!isLocalhost) {
        const favicon = document.getElementById('favicon')
        if (favicon) {
          favicon.href = `${assetBase}vite.svg`
        }

        void ensureStylesheets()
      }
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module">
      const bootstrapConfig = window.__APP_BOOTSTRAP__ ?? {}
      const {
        isLocalhost = false,
        assetBase = './',
        ensureStylesheets = () => Promise.resolve(),
        resolveMainModule = () => Promise.resolve('/src/main.tsx'),
      } = bootstrapConfig

      const loadRuntimeConfig = () => {
        if (isLocalhost) {
          return Promise.resolve(false)
        }

        return new Promise((resolve) => {
          const script = document.createElement('script')
          script.src = `${assetBase}firebase-config.js`
          script.async = false
          script.onload = () => resolve(true)
          script.onerror = () => {
            console.warn(
              '[Firebase] No runtime config found at',
              `${assetBase}firebase-config.js`.replace('././', './'),
              'â€” falling back to build-time environment variables.',
            )
            resolve(false)
          }
          document.head.appendChild(script)
        })
      }

      const bootstrap = async () => {
        await loadRuntimeConfig()

        if (isLocalhost) {
          try {
            await import('/src/main.tsx')
            return
          } catch (error) {
            console.error('[Bootstrap] Failed to load local entry module', error)
          }
        }

        await ensureStylesheets()

        const entryModule = await resolveMainModule()

        try {
          await import(entryModule)
        } catch (error) {
          console.error('[Bootstrap] Failed to load entry module', entryModule, error)
        }
      }

      bootstrap().catch((error) => {
        console.error('[Bootstrap] Unexpected error during initialization', error)
      })
    </script>
  </body>
</html>
